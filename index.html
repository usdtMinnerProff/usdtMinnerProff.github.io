<!DOCTYPE html>
<html>
<head>
    <title>dApp Educativa - Pruebas de Seguridad en Testnet</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .warning { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin: 10px 0; }
        button { padding: 12px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        #connectWallet { background: #4caf50; color: white; }
        #fakeAirdrop { background: #ff9800; color: white; }
        #maliciousStake { background: #f44336; color: white; }
        .transaction-info { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="warning">
        <strong>‚ö†Ô∏è ADVERTENCIA: ESTA ES UNA dAPP EDUCATIVA</strong><br>
        Solo usar en BNB Testnet. NO usar con wallets principales o en mainnet.
    </div>

    <h1>dApp Educativa - Simulador de Estafas (Testnet)</h1>
    
    <div id="walletInfo" style="display:none;">
        <h3>Wallet Conectada: <span id="walletAddress"></span></h3>
    </div>

    <button id="connectWallet">Conectar Wallet</button>
    <button id="fakeAirdrop">Simular Airdrop (0.001 BNB)</button>
    <button id="maliciousStake">Simular Staking Malicioso</button>
    <button id="fakeApproval">Solicitud Aprobaci√≥n Ilimitada</button>

    <div id="transactionStatus"></div>

    <script>
        let connectedAccount = null;

        // Configuraci√≥n para BNB Testnet
        const BNB_TESTNET_CHAIN_ID = '0x61'; // 97 en decimal
        const FAKE_TOKEN_ADDRESS = '0x...'; // Aqu√≠ pondr√≠as un contrato de testnet

        document.getElementById('connectWallet').addEventListener('click', async () => {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    // Verificar que est√© en BNB Testnet
                    const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                    
                    if (chainId !== BNB_TESTNET_CHAIN_ID) {
                        alert('Por favor cambia a BNB Testnet (Chain ID: 97)');
                        try {
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: BNB_TESTNET_CHAIN_ID }],
                            });
                        } catch (switchError) {
                            console.error('Error cambiando de red:', switchError);
                        }
                        return;
                    }

                    const accounts = await window.ethereum.request({
                        method: 'eth_requestAccounts'
                    });
                    
                    connectedAccount = accounts[0];
                    document.getElementById('walletAddress').textContent = connectedAccount;
                    document.getElementById('walletInfo').style.display = 'block';
                    
                    console.log('Cuenta conectada:', connectedAccount);
                    
                    updateStatus('‚úÖ Wallet conectada correctamente', 'success');
                    
                } else {
                    updateStatus('‚ùå MetaMask no detectado', 'error');
                }
            } catch (error) {
                console.error('Error de conexi√≥n:', error);
                updateStatus('‚ùå Error conectando wallet', 'error');
            }
        });

        // Simular transacci√≥n de airdrop (env√≠a 0.001 BNB)
        document.getElementById('fakeAirdrop').addEventListener('click', async () => {
            if (!connectedAccount) {
                alert('Primero conecta tu wallet');
                return;
            }

            try {
                updateStatus('‚è≥ Enviando transacci√≥n de airdrop...', 'info');
                
                const transactionParameters = {
                    to: connectedAccount, // En realidad se env√≠a a s√≠ mismo
                    from: connectedAccount,
                    value: '0x38D7EA4C68000', // 0.001 BNB en hex
                    gas: '0x5208', // 21000 gas
                    gasPrice: '0x3B9ACA00' // 1 Gwei
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });

                updateStatus(`‚úÖ Transacci√≥n enviada: ${txHash}`, 'success');
                
            } catch (error) {
                console.error('Error en transacci√≥n:', error);
                updateStatus('‚ùå Usuario rechaz√≥ la transacci√≥n', 'error');
            }
        });

        // Solicitud de aprobaci√≥n ilimitada (simulada)
        document.getElementById('fakeApproval').addEventListener('click', async () => {
            if (!connectedAccount) {
                alert('Primero conecta tu wallet');
                return;
            }

            try {
                updateStatus('‚è≥ Preparando aprobaci√≥n ilimitada...', 'info');
                
                // En una estafa real, esto ser√≠a una llamada a un contrato malicioso
                // Simulamos la transacci√≥n pero con valores m√≠nimos
                const transactionParameters = {
                    to: connectedAccount, // Envi√°ndose a s√≠ mismo para evitar p√©rdidas
                    from: connectedAccount,
                    value: '0x0', // Sin valor
                    data: '0x095ea7b30000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff', // Aprobaci√≥n ilimitada simulada
                    gas: '0x186A0' // 100,000 gas
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });

                updateStatus(`‚ö†Ô∏è APROBACI√ìN ILIMITADA SIMULADA: ${txHash}`, 'warning');
                alert('¬°ESTA ES UNA SIMULACI√ìN! En una estafa real, perder√≠as el control de tus tokens.');
                
            } catch (error) {
                console.error('Error en aprobaci√≥n:', error);
                updateStatus('‚úÖ Usuario detect√≥ comportamiento sospechoso', 'success');
            }
        });

        // Simulaci√≥n de staking malicioso
        document.getElementById('maliciousStake').addEventListener('click', async () => {
            if (!connectedAccount) {
                alert('Primero conecta tu wallet');
                return;
            }

            try {
                updateStatus('‚è≥ Configurando staking malicioso...', 'info');
                
                const transactionParameters = {
                    to: connectedAccount, // De nuevo, envi√°ndose a s√≠ mismo
                    from: connectedAccount,
                    value: '0x0',
                    data: '0x00000000', // Datos simulados de contrato malicioso
                    gas: '0x30D40' // 200,000 gas
                };

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });

                updateStatus(`üî¥ STAKING MALICIOSO SIMULADO: ${txHash}`, 'warning');
                alert('SIMULACI√ìN: En una estafa real, esta transacci√≥n drenar√≠a tu wallet');
                
            } catch (error) {
                console.error('Error en staking:', error);
                updateStatus('‚úÖ Transacci√≥n rechazada correctamente', 'success');
            }
        });

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('transactionStatus');
            statusDiv.innerHTML = `
                <div class="transaction-info" style="background: ${
                    type === 'success' ? '#e8f5e8' : 
                    type === 'error' ? '#ffebee' : 
                    type === 'warning' ? '#fff3e0' : '#e3f2fd'
                }">
                    <strong>${message}</strong>
                </div>
            `;
        }

        // Listeners para cambios de cuenta y red
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    connectedAccount = null;
                    document.getElementById('walletInfo').style.display = 'none';
                    updateStatus('üîí Wallet desconectada', 'info');
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                if (chainId !== BNB_TESTNET_CHAIN_ID) {
                    updateStatus('‚ö†Ô∏è Cambia a BNB Testnet (Chain ID: 97)', 'warning');
                }
            });
        }
    </script>

    <div class="warning">
        <h3>üîç Lo que debes aprender:</h3>
        <ul>
            <li>Siempre verifica la red en la que est√°s</li>
            <li>Revisa los permisos de aprobaci√≥n antes de firmar</li>
            <li>Nunca des aprobaciones ilimitadas a contratos no verificados</li>
            <li>Los airdrops leg√≠timos NO requieren que pagues fees por adelantado</li>
        </ul>
    </div>
</body>
</html>
